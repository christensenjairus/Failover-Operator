---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.16.1
  name: failoverpolicies.crd.hahomelabs.com
spec:
  group: crd.hahomelabs.com
  names:
    kind: FailoverPolicy
    listKind: FailoverPolicyList
    plural: failoverpolicies
    singular: failoverpolicy
  scope: Namespaced
  versions:
  - name: v1alpha1
    schema:
      openAPIV3Schema:
        description: FailoverPolicy is the Schema for the failoverpolicies API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: FailoverPolicySpec defines the desired state of FailoverPolicy
            properties:
              components:
                description: Components defines the application components and their
                  associated resources
                items:
                  description: ComponentSpec defines a component in the application
                    being managed
                  properties:
                    name:
                      description: Name of the component
                      type: string
                    virtualServices:
                      description: VirtualServices are the Istio virtual services
                        associated with this component
                      items:
                        type: string
                      type: array
                    volumeReplications:
                      description: VolumeReplications are the volume replications
                        associated with this component
                      items:
                        type: string
                      type: array
                    workloads:
                      description: Workloads are the resources that make up this component
                      items:
                        description: ResourceRef defines a simple reference to a Kubernetes
                          resource by kind and name
                        properties:
                          kind:
                            description: Kind of the resource
                            type: string
                          name:
                            description: Name of the resource
                            type: string
                        required:
                        - kind
                        - name
                        type: object
                      type: array
                  required:
                  - name
                  type: object
                minItems: 1
                type: array
              cronJobs:
                description: |-
                  CronJobs is a list of CronJob objects to suspend when in passive mode.
                  Deprecated: Use components[].workloads instead
                items:
                  description: |-
                    ResourceReference defines a reference to a Kubernetes resource by name and optional namespace
                    Deprecated: Use ManagedResource instead
                  properties:
                    name:
                      description: Name of the resource
                      type: string
                    namespace:
                      description: Namespace of the resource (optional)
                      type: string
                  required:
                  - name
                  type: object
                type: array
              deployments:
                description: |-
                  Deployments is a list of Deployment objects to scale down to 0 replicas when in passive mode.
                  Deprecated: Use components[].workloads instead
                items:
                  description: |-
                    ResourceReference defines a reference to a Kubernetes resource by name and optional namespace
                    Deprecated: Use ManagedResource instead
                  properties:
                    name:
                      description: Name of the resource
                      type: string
                    namespace:
                      description: Namespace of the resource (optional)
                      type: string
                  required:
                  - name
                  type: object
                type: array
              desiredState:
                description: |-
                  DesiredState represents the intended failover state ("active" or "passive").
                  Deprecated: Use metadata.annotations[failover-operator.hahomelabs.com/desired-state] instead with values "PRIMARY" or "STANDBY"
                enum:
                - active
                - passive
                type: string
              failoverMode:
                description: |-
                  FailoverMode determines the failover approach: "safe" ensures data is fully synced before failover,
                  while "fast" allows immediate transition without waiting.
                enum:
                - safe
                - fast
                type: string
              helmReleases:
                description: |-
                  HelmReleases is a list of Flux HelmRelease objects to suspend when in passive mode.
                  Deprecated: Use parentFluxResources instead
                items:
                  description: |-
                    ResourceReference defines a reference to a Kubernetes resource by name and optional namespace
                    Deprecated: Use ManagedResource instead
                  properties:
                    name:
                      description: Name of the resource
                      type: string
                    namespace:
                      description: Namespace of the resource (optional)
                      type: string
                  required:
                  - name
                  type: object
                type: array
              kustomizations:
                description: |-
                  Kustomizations is a list of Flux Kustomization objects to suspend when in passive mode.
                  Deprecated: Use parentFluxResources instead
                items:
                  description: |-
                    ResourceReference defines a reference to a Kubernetes resource by name and optional namespace
                    Deprecated: Use ManagedResource instead
                  properties:
                    name:
                      description: Name of the resource
                      type: string
                    namespace:
                      description: Namespace of the resource (optional)
                      type: string
                  required:
                  - name
                  type: object
                type: array
              managedResources:
                description: |-
                  ManagedResources is a list of resources to be managed by this failover policy.
                  Deprecated: Use Components instead
                items:
                  description: ManagedResource defines a resource managed by the failover
                    operator
                  properties:
                    apiGroup:
                      description: |-
                        APIGroup specifies the Kubernetes API group for this resource
                        If not provided, the default API group for the specified Kind will be used
                      enum:
                      - replication.storage.openshift.io
                      - apps
                      - batch
                      - networking.istio.io
                      - helm.toolkit.fluxcd.io
                      - kustomize.toolkit.fluxcd.io
                      type: string
                    kind:
                      description: Kind specifies the type of resource (e.g., Deployment,
                        StatefulSet, CronJob)
                      enum:
                      - VolumeReplication
                      - Deployment
                      - StatefulSet
                      - CronJob
                      - VirtualService
                      - HelmRelease
                      - Kustomization
                      type: string
                    name:
                      description: Name of the resource
                      type: string
                    namespace:
                      description: |-
                        Namespace of the resource
                        If not provided, the FailoverPolicy's namespace will be used
                      type: string
                  required:
                  - kind
                  - name
                  type: object
                type: array
              mode:
                description: |-
                  Mode determines the failover approach. "safe" ensures VolumeReplication is fully synced before failover,
                  while "unsafe" allows immediate transition without waiting.
                  Deprecated: Use failoverMode instead
                enum:
                - safe
                - unsafe
                type: string
              parentFluxResources:
                description: ParentFluxResources defines the Flux resources that need
                  to be suspended during failover operations
                items:
                  description: ResourceRef defines a simple reference to a Kubernetes
                    resource by kind and name
                  properties:
                    kind:
                      description: Kind of the resource
                      type: string
                    name:
                      description: Name of the resource
                      type: string
                  required:
                  - kind
                  - name
                  type: object
                type: array
              statefulSets:
                description: |-
                  StatefulSets is a list of StatefulSet objects to scale down to 0 replicas when in passive mode.
                  Deprecated: Use components[].workloads instead
                items:
                  description: |-
                    ResourceReference defines a reference to a Kubernetes resource by name and optional namespace
                    Deprecated: Use ManagedResource instead
                  properties:
                    name:
                      description: Name of the resource
                      type: string
                    namespace:
                      description: Namespace of the resource (optional)
                      type: string
                  required:
                  - name
                  type: object
                type: array
              virtualServices:
                description: |-
                  VirtualServices is a list of VirtualService objects to update during failover.
                  Deprecated: Use components[].virtualServices instead
                items:
                  description: |-
                    ResourceReference defines a reference to a Kubernetes resource by name and optional namespace
                    Deprecated: Use ManagedResource instead
                  properties:
                    name:
                      description: Name of the resource
                      type: string
                    namespace:
                      description: Namespace of the resource (optional)
                      type: string
                  required:
                  - name
                  type: object
                type: array
              volumeReplications:
                description: |-
                  VolumeReplications is a list of VolumeReplication objects to manage in this failover policy.
                  Deprecated: Use components[].volumeReplications instead
                items:
                  description: |-
                    ResourceReference defines a reference to a Kubernetes resource by name and optional namespace
                    Deprecated: Use ManagedResource instead
                  properties:
                    name:
                      description: Name of the resource
                      type: string
                    namespace:
                      description: Namespace of the resource (optional)
                      type: string
                  required:
                  - name
                  type: object
                type: array
            required:
            - components
            - failoverMode
            type: object
          status:
            description: FailoverPolicyStatus defines the observed state of FailoverPolicy
            properties:
              components:
                description: Components contains status information for each component
                  defined in the spec
                items:
                  description: ComponentStatus defines the status of a component
                  properties:
                    health:
                      description: |-
                        Health indicates the health status of the component
                        Values: "OK", "DEGRADED", "ERROR"
                      enum:
                      - OK
                      - DEGRADED
                      - ERROR
                      type: string
                    message:
                      description: Message provides additional details about the component
                        health
                      type: string
                    name:
                      description: Name of the component
                      type: string
                  required:
                  - health
                  - name
                  type: object
                type: array
              conditions:
                description: Conditions represent the current state of failover reconciliation.
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
              health:
                description: |-
                  Health indicates the overall health of the failover policy
                  Values: "OK", "DEGRADED", "ERROR"
                enum:
                - OK
                - DEGRADED
                - ERROR
                type: string
              lastTransitionDetails:
                description: LastTransitionDetails contains detailed information about
                  the last state transition
                type: string
              lastTransitionMessage:
                description: LastTransitionMessage is a human-readable message describing
                  the last state transition
                type: string
              lastTransitionReason:
                description: LastTransitionReason is the reason for the last state
                  transition
                type: string
              lastTransitionTime:
                description: LastTransitionTime is the time when the last state transition
                  occurred
                type: string
              state:
                description: State reflects the actual failover state ("PRIMARY" or
                  "STANDBY") of the system.
                enum:
                - PRIMARY
                - STANDBY
                type: string
              volumeReplicationStatuses:
                description: VolumeReplicationStatuses contains status information
                  for VolumeReplications
                items:
                  description: VolumeReplicationStatus defines the status of a VolumeReplication
                  properties:
                    error:
                      type: string
                    lastUpdateTime:
                      type: string
                    message:
                      type: string
                    name:
                      type: string
                    state:
                      type: string
                  required:
                  - name
                  - state
                  type: object
                type: array
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
